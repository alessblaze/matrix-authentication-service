{#
Copyright 2024, 2025 New Vector Ltd.
Copyright 2021-2024 The Matrix.org Foundation C.I.C.

SPDX-License-Identifier: AGPL-3.0-only OR LicenseRef-Element-Commercial
Please see LICENSE files in the repository root for full details.
-#}

{% extends "base.html" %}

{% block title %}Create account - AMS{% endblock title %}

{% block content %}
  <style>
    body { background: linear-gradient(135deg, rgb(76 29 149), rgb(88 28 135), rgb(67 56 202)) !important; min-height: 100vh; }
    .layout-container { background: transparent !important; display: flex !important; align-items: center !important; justify-content: center !important; min-height: 100vh !important; padding: 1rem !important; }
    form { background: rgba(255, 255, 255, 0.1) !important; backdrop-filter: blur(10px) !important; border-radius: 1rem !important; padding: 1rem 2rem 2rem 2rem !important; border: 1px solid rgba(255, 255, 255, 0.2) !important; width: 100% !important; max-width: 500px !important; }
    .cpd-text-control { background: rgba(255, 255, 255, 0.1) !important; border: 1px solid rgba(255, 255, 255, 0.2) !important; color: white !important; }
    .cpd-text-control::placeholder { color: rgba(196, 181, 253, 0.6) !important; }
    .cpd-text-control:focus { border-color: rgb(139, 92, 246) !important; box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.3) !important; }
    .cpd-button[data-kind="secondary"] { background: rgba(255, 255, 255, 0.1) !important; border: 1px solid rgba(255, 255, 255, 0.2) !important; color: white !important; }
    .cpd-button[data-kind="secondary"]:hover { background: rgba(255, 255, 255, 0.2) !important; }
    .cpd-text-secondary { color: white !important; }
    .title, .text { color: white !important; }
    .cpd-button[data-kind="primary"], .cpd-button:not([data-kind]) { background: rgb(139, 92, 246) !important; border: 1px solid rgb(139, 92, 246) !important; color: white !important; }
    .cpd-button[data-kind="primary"]:hover, .cpd-button:not([data-kind]):hover { background: rgb(124, 58, 237) !important; border: 1px solid rgb(124, 58, 237) !important; }
    .icon { background: rgba(255, 255, 255, 0.1) !important; border: 1px solid rgba(255, 255, 255, 0.2) !important; border-radius: 0.75rem !important; padding: 1rem !important; display: inline-flex !important; align-items: center !important; justify-content: center !important; }
    .icon svg { color: white !important; width: 2rem !important; height: 2rem !important; }
    .cpd-form-help-message { color: rgba(255, 255, 255, 0.7) !important; }
    .text-critical { color: rgb(248, 113, 113) !important; }
    .cpd-checkbox-input:checked + .cpd-checkbox-ui { background: rgb(139, 92, 246) !important; border-color: rgb(139, 92, 246) !important; }
    .cpd-checkbox-input:checked + .cpd-checkbox-ui svg { color: white !important; }
    .cpd-checkbox-ui { background: rgba(255, 255, 255, 0.1) !important; border: 1px solid rgba(255, 255, 255, 0.2) !important; }
    .cpd-form-field-label { color: white !important; }
    .cpd-form-field-label a { color: rgba(196, 181, 253, 0.8) !important; }
    .cpd-form-field-label a:hover { color: white !important; background: transparent !important; }
    a { color: rgba(196, 181, 253, 0.8) !important; }
    a:hover { color: white !important; background: transparent !important; text-decoration: underline !important; }

  </style>
  <form method="POST" class="cpd-form-root">
    <header class="page-heading">
      <div class="icon">
        {{ icon.user_profile_solid() }}
      </div>

      <div class="header">
        <h1 class="title">{{ _("mas.register.create_account.heading") }}</h1>
      </div>
    </header>
    {% for error in form.errors %}
      {# Special case for the captcha error, as we want to put it at the bottom #}
      {% if error.kind != "captcha" %}
        <div class="text-critical font-medium">
          {{ errors.form_error_message(error=error) }}
        </div>
      {% endif %}
    {% endfor %}

    <input type="hidden" name="csrf" value="{{ csrf_token }}" />

    {% call(f) field.field(label=_("common.username"), name="username", form_state=form) %}
      <input {{ field.attributes(f) }} class="cpd-text-control" type="text" autocomplete="username" autocorrect="off" autocapitalize="none" required data-choose-username />
      {{ field.error(error={"kind": "policy", "code": "username-invalid-chars"}, hidden=true) }}
    {% endcall %}

    {% if features.password_registration_email_required %}
      {% call(f) field.field(label=_("common.email_address"), name="email", form_state=form) %}
        <input {{ field.attributes(f) }} class="cpd-text-control" type="email" autocomplete="email" required />
      {% endcall %}
    {% endif %}

    {% call(f) field.field(label=_("common.password"), name="password", form_state=form) %}
      <input {{ field.attributes(f) }} class="cpd-text-control" type="password" autocomplete="new-password" required />
    {% endcall %}

    {% call(f) field.field(label=_("common.password_confirm"), name="password_confirm", form_state=form) %}
      <input {{ field.attributes(f) }} class="cpd-text-control" type="password" autocomplete="new-password" required />
    {% endcall %}

    {% if branding.tos_uri is not none %}
      {% call(f) field.field(label=_("mas.register.terms_of_service", tos_uri=branding.tos_uri), name="accept_terms", form_state=form, inline=true, class="my-4") %}
        <div class="cpd-form-inline-field-control">
          <div class="cpd-checkbox-container">
            <input {{ field.attributes(f) }} class="cpd-checkbox-input" type="checkbox" required />
            <div class="cpd-checkbox-ui">
              {{ icon.check() }}
            </div>
          </div>
        </div>
      {% endcall %}
    {% endif %}

    {{ captcha.form(class="mb-4 self-center") }}

    {% for error in form.errors %}
      {# Special case for the captcha error #}
      {% if error.kind == "captcha" %}
        <div class="text-critical font-medium text-center -mt-4 mb-4">
          {{ errors.form_error_message(error=error) }}
        </div>
      {% endif %}
    {% endfor %}

    {{ button.button(text=_("action.continue")) }}

    {% set params = next["params"] | default({}) | to_params(prefix="?") %}
    <a class="cpd-button" data-kind="secondary" data-size="lg" href="{{ '/login' ~ params | prefix_url }}">{{ _("mas.register.call_to_login") }}</a>
  </form>
{% endblock content %}
